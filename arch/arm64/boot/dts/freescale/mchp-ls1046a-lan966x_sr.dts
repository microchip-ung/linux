// SPDX-License-Identifier: (GPL-2.0+ OR MIT)

/dts-v1/;

#include "fsl-ls1046a.dtsi"
#include "fsl-ls1046a-miriac-mpxls1046.dtsi"

#include <dt-bindings/soc/mchp,lan966x_ecpu_sr.h>

/ {
	model = "Microsys miriac SBC-LS1046A Sunrise";
	compatible = "microsys,sbc1046a", "microsys,mpxls1046a", "fsl,ls1046a";

	aliases {
		ethernet0 = &enet2;
		ethernet1 = &enet4;
		ethernet2 = &enet5;
		ethernet3 = &enet6;
		ethernet4 = &lan966x_switch;

		serial0 = &duart0;
		serial1 = &duart1;
		serial2 = &duart2;
		serial3 = &duart3;
	};

	chosen {
		stdout-path = "serial0:115200n8";
	};
};

&duart0 {
	status = "okay";
};

&duart1 {
	status = "okay";
};

&i2c0 {
	status = "okay";

	eeprom@57 {
		compatible = "at24,24c128";
		reg = <0x57>;
	};
};

&i2c1 {
	status = "okay";
};

&ifc {
	nand@0,0 {
		partition@0 {
			reg = <0x0 0x00100000>;
			label = "UBoot";
			read-only;
		};

		partition@100000 {
			reg = <0x00100000 0x00040000>;
			label = "Env";
		};

		partition@140000 {
			reg = <0x00140000 0x00040000>;
			label = "Env.bk";
		};

		partition@180000 {
			reg = <0x00180000 0x00080000>;
			label = "Unused";
		};

		partition@200000 {
			reg = <0x00200000 0x01400000>;
			label = "linux";
		};

		partition@1600000 {
			reg = <0x01600000 0x01400000>;
			label = "linux.bk";
		};

		partition@2a00000 {
			reg = <0x02a00000 0x1d600000>;
			label = "rootfs_data";
		};
	};
};

#include "fsl-ls1046-post.dtsi"

&fman0 {
	compatible = "fsl,fman", "simple-bus";

	ethernet@e4000 {
		phy-handle = <&rgmii_phy1>;
		phy-connection-type = "rgmii";
	};

	ethernet@e8000 {
		phy-handle = <&sgmii_phy1>;
		phy-connection-type = "sgmii";
	};

	ethernet@ea000 {
		phy-handle = <&sgmii_phy2>;
		phy-connection-type = "sgmii";
	};

	ethernet@f0000 {
		phy-handle = <&sgmii_phy3>;
		phy-connection-type = "sgmii";
	};

	mdio@fc000 {
		rgmii_phy1: ethernet-phy@3 {
			reg = <3>;
		};

		sgmii_phy1: ethernet-phy@2 {
			reg = <2>;
		};

		sgmii_phy2: ethernet-phy@1 {
			reg = <1>;
		};

		sgmii_phy3: ethernet-phy@0 {
			reg = <0>;
		};
	};
};

&pcie1 {
	pci@0,0 {
		#address-cells = <3>;
		#size-cells = <2>;
		reg = <0 0 0 0 0>;
		device_type = "pci";
		ranges = <0x82000000 0x0 0x40000000 0x82000000 0x0 0x40000000 0 0x40000000>;

		lan966x: switch@101b,9956 {
			compatible = "pci101b,9962";

			reg = <0x0000 0 0 0 0>;
			#address-cells = <1>;
			#size-cells = <1>;
			ranges = <0x00000000 0x82000000 0x0 0x40000000 0x4000000>,
				 <0x44000000 0x82000000 0x0 0x44000000 0x020000>;

			#interrupt-cells = <1>;
			interrupt-controller;
			interrupt-parent = <&lan966x>;

			lan966x_uio0: mscc_switch@0 {
				compatible = "microchip,uio_lan966x_irqmux";
				reg = <0x0 0x4000000>;
				status = "okay";
			};

			lan966x_uio1: mscc_sram@44000000 {
				compatible = "microchip,uio_lan966x_irqmux";
				reg = <0x44000000 0x20000>;
				status = "okay";
			};

			gpio: pinctrl@e2004070 {
				compatible = "microchip,lan966x-pinctrl";
				reg = <GCB_GPIO_ADDR GCB_GPIO_SIZE>,
				      <CHIP_TOP_GPIO_CFG_ADDR CHIP_TOP_GPIO_CFG_SIZE>;
				gpio-controller;
				#gpio-cells = <2>;
				gpio-ranges = <&gpio 0 0 78>;

				mdio_pins: mdio_pins {
					pins =  "GPIO_29";
					function = "mdio";
				};

				mdc_pins: mdc_pins {
					pins =  "GPIO_28";
					function = "mdc";
				};

				tod_pins: tod_pins {
					pins = "GPIO_36";
					function = "ptpsync_1";
				};
			};

			lan966x_mdio0: mdio@700e8 {
				#address-cells = <1>;
				#size-cells = <0>;
				compatible = "mscc,ocelot-miim";
				reg = <GCB_MIIM_0_ADDR GCB_MIIM_0_SIZE>;
				status = "okay";

				pinctrl-0 = <&mdio_pins>, <&mdc_pins>;
				pinctrl-names = "default";

				phy0: ethernet-phy@0 {
					reg = <4>;
				};
				phy1: ethernet-phy@1 {
					reg = <5>;
				};
				phy2: ethernet-phy@2 {
					reg = <6>;
				};
				phy3: ethernet-phy@3 {
					reg = <7>;
				};
				phy4: ethernet-phy@4 {
					reg = <0>;
				};
				phy5: ethernet-phy@5 {
					reg = <1>;
				};
				phy6: ethernet-phy@6 {
					reg = <2>;
				};
				phy7: ethernet-phy@7 {
					reg = <3>;
				};
			};

			dma: dma-controller@200a0400 {
				compatible = "lan966x-fdma";

				reg = <FDMA_ADDR FDMA_SIZE>;
				reg-names = "fdma";
				interrupts = <14>;
				interrupt-names = "fdma";

				#dma-cells = <1>;
				dma-channels = <8>;
				status = "okay";

				memory-region = <&fdma_memory>;
			};

			lan966x_switch: switch@0 {
				compatible = "mchp,lan966x-switch";
				reg = <ORG_0_ADDR ORG_0_SIZE>,
				      <SYS_ADDR SYS_SIZE>,
				      <QS_ADDR QS_SIZE>,
				      <QSYS_ADDR QSYS_SIZE>,

				      <ANA_ADDR ANA_SIZE>,
				      <REW_ADDR REW_SIZE>,
				      <GCB_ADDR 0x44>,
				      <PTP_ADDR PTP_SIZE>,

				      <VCAP_0_ADDR VCAP_0_SIZE>,
				      <VCAP_1_ADDR VCAP_1_SIZE>,
				      <VCAP_2_ADDR VCAP_2_SIZE>,
				      <AFI_ADDR AFI_SIZE>,
				      <MEP_ADDR MEP_SIZE>,

				      <CPU_ADDR CPU_SIZE>,
				      <SUNRISE_TOP_ADDR SUNRISE_TOP_SIZE>,
				      <FDMA_ADDR FDMA_SIZE>,

				      <DEV_0_ADDR DEV_0_SIZE>,
				      <DEV_1_ADDR DEV_1_SIZE>,
				      <DEV_2_ADDR DEV_2_SIZE>,
				      <DEV_3_ADDR DEV_3_SIZE>,
				      <DEV_4_ADDR DEV_4_SIZE>,
				      <DEV_5_ADDR DEV_5_SIZE>,
				      <DEV_6_ADDR DEV_6_SIZE>,
				      <DEV_7_ADDR DEV_7_SIZE>;

				reg-names = "org", "sys", "qs", "qsys",
					    "ana", "rew", "gcb", "ptp",
					    "es0", "s1", "s2", "afi", "mep",
					    "cpu", "sunrise_top", "fdma",
					    "port0", "port1", "port2", "port3",
					    "port4", "port5", "port6", "port7";

				interrupts = <10 11 12 9>;
				interrupt-names = "ptp-sync", "ptp", "xtr", "ana";

				pinctrl-0 = <&tod_pins>;
				pinctrl-names = "default";

				dmas = <&dma 0>, <&dma 6>;
				dma-names = "tx", "rx";

				ethernet-ports {
					#address-cells = <1>;
					#size-cells = <0>;

					port0: port@0 {
						reg = <0>;
						phy-handle = <&phy0>;
						phy-mode = "gmii";
						#address-cells = <1>;
						#size-cells = <0>;

						delay0 {
							reg = <0>;
							speed = <1000>;
							rx_delay = <0x25000>;
							tx_delay = <0x25000>;
						};

						delay1 {
							reg = <0>;
							speed = <100>;
							rx_delay = <0x8f050>;
							tx_delay = <0x8f050>;
						};

						delay2 {
							reg = <0>;
							speed = <10>;
							rx_delay = <0x4b8000>;
							tx_delay = <0x4b8000>;
						};
					};

					port1: port@1 {
						reg = <1>;
						phy-handle = <&phy1>;
						phy-mode = "gmii";
						#address-cells = <1>;
						#size-cells = <0>;

						delay0 {
							reg = <0>;
							speed = <1000>;
							rx_delay = <0x25000>;
							tx_delay = <0x25000>;
						};

						delay1 {
							reg = <0>;
							speed = <100>;
							rx_delay = <0x8f050>;
							tx_delay = <0x8f050>;
						};

						delay2 {
							reg = <0>;
							speed = <10>;
							rx_delay = <0x4b8000>;
							tx_delay = <0x4b8000>;
						};
					};

					port2: port@2 {
						reg = <2>;
						phy-handle = <&phy2>;
						phy-mode = "gmii";
						#address-cells = <1>;
						#size-cells = <0>;

						delay0 {
							reg = <0>;
							speed = <1000>;
							rx_delay = <0x25000>;
							tx_delay = <0x25000>;
						};

						delay1 {
							reg = <0>;
							speed = <100>;
							rx_delay = <0x8f050>;
							tx_delay = <0x8f050>;
						};

						delay2 {
							reg = <0>;
							speed = <10>;
							rx_delay = <0x4b8000>;
							tx_delay = <0x4b8000>;
						};
					};

					port3: port@3 {
						reg = <3>;
						phy-handle = <&phy3>;
						phy-mode = "gmii";
						#address-cells = <1>;
						#size-cells = <0>;

						delay0 {
							reg = <0>;
							speed = <1000>;
							rx_delay = <0x25000>;
							tx_delay = <0x25000>;
						};

						delay1 {
							reg = <0>;
							speed = <100>;
							rx_delay = <0x8f050>;
							tx_delay = <0x8f050>;
						};

						delay2 {
							reg = <0>;
							speed = <10>;
							rx_delay = <0x4b8000>;
							tx_delay = <0x4b8000>;
						};
					};

					port4: port@4 {
						reg = <4>;
						phy-handle = <&phy4>;
						phy-mode = "qsgmii";
						#address-cells = <1>;
						#size-cells = <0>;

						delay0 {
							reg = <0>;
							speed = <1000>;
							rx_delay = <0x25000>;
							tx_delay = <0x25000>;
						};

						delay1 {
							reg = <0>;
							speed = <100>;
							rx_delay = <0x8f050>;
							tx_delay = <0x8f050>;
						};

						delay2 {
							reg = <0>;
							speed = <10>;
							rx_delay = <0x4b8000>;
							tx_delay = <0x4b8000>;
						};
					};

					port5: port@5 {
						reg = <5>;
						phy-handle = <&phy5>;
						phy-mode = "qsgmii";
						#address-cells = <1>;
						#size-cells = <0>;

						delay0 {
							reg = <0>;
							speed = <1000>;
							rx_delay = <0x25000>;
							tx_delay = <0x25000>;
						};

						delay1 {
							reg = <0>;
							speed = <100>;
							rx_delay = <0x8f050>;
							tx_delay = <0x8f050>;
						};

						delay2 {
							reg = <0>;
							speed = <10>;
							rx_delay = <0x4b8000>;
							tx_delay = <0x4b8000>;
						};
					};

					port6: port@6 {
						reg = <6>;
						phy-handle = <&phy6>;
						phy-mode = "qsgmii";
						#address-cells = <1>;
						#size-cells = <0>;

						delay0 {
							reg = <0>;
							speed = <1000>;
							rx_delay = <0x25000>;
							tx_delay = <0x25000>;
						};

						delay1 {
							reg = <0>;
							speed = <100>;
							rx_delay = <0x8f050>;
							tx_delay = <0x8f050>;
						};

						delay2 {
							reg = <0>;
							speed = <10>;
							rx_delay = <0x4b8000>;
							tx_delay = <0x4b8000>;
						};
					};

					port7: port@7 {
						reg = <7>;
						phy-handle = <&phy7>;
						phy-mode = "qsgmii";
						#address-cells = <1>;
						#size-cells = <0>;

						delay0 {
							reg = <0>;
							speed = <1000>;
							rx_delay = <0x25000>;
							tx_delay = <0x25000>;
						};

						delay1 {
							reg = <0>;
							speed = <100>;
							rx_delay = <0x8f050>;
							tx_delay = <0x8f050>;
						};

						delay2 {
							reg = <0>;
							speed = <10>;
							rx_delay = <0x4b8000>;
							tx_delay = <0x4b8000>;
						};
					};
				};
			};
		};
	};
};
